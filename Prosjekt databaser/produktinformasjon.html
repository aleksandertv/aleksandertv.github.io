<!DOCTYPE html>
<html lang="nb" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title class="titleProduktinformasjon"></title>
    <link rel="stylesheet" href="stilark.css">
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyAYjQqL4aFw1GtynRH4832HuESJDaMqFmc",
        authDomain: "prosjektalvetodatabaser.firebaseapp.com",
        databaseURL: "https://prosjektalvetodatabaser.firebaseio.com",
        projectId: "prosjektalvetodatabaser",
        storageBucket: "prosjektalvetodatabaser.appspot.com",
        messagingSenderId: "332394662422"
      };
      firebase.initializeApp(config);
    </script>
  </head>
  <body>
    <header id="headerproduktinformasjon">
      <nav>
        <a href="forside.html"><img src="Bilder/Generellebilder/Logo.png" alt="logo, alveto" id="logobilde"></a>
        <ul id="navbar">
          <li><a id="navKlaer" class="navProduktHref" href="produkter.html">Klær</a></li>
          <li><a id="navNyligLagtTil" class="navProduktHref" href="produkter.html">Nylig lagt til</a></li>
          <li><a id="navSalg" class="navProduktHref" href="produkter.html?id=salg">Salg</a></li>
          <li><a id="navHandlekurv" class="navEkstraHref" href="#">Handlekurv</a></li>
          <li><a id="navOenskeliste" class="navEkstraHref" href="#">Ønskeliste</a></li>
          <li><a id="navLoggInn" class="navEkstraHref" href="#">Logg inn</a></li>
        </ul>
      </nav>
    </header>
    <main id="mainproduktinformasjon">
      <ul id="tilbake">
        <li><a href="produkter.html"> < Tilbake </a></li>
      </ul>
      <section class="secProduktinfo">

      </section>
      <section class="overskrift">
        <p>Andre har også kjøpt</p>
      </section>
      <section class="secProduktLignende">

      </section>
    </main>
    <footer>
      <section>
        <div><a class="footerOverskrift" href="#">Om Alveto</a></div>
        <div><a class="footerInnhold" href="#">Firmainformasjon</a></div>
        <div><a class="footerInnhold" href="#">Historikk</a></div>
        <div><a class="footerInnhold" href="#">Søk jobb hos oss</a></div>
        <div><a class="footerInnhold" href="#">Ansatte</a></div>
      </section>
      <section>
        <div><a class="footerOverskrift" href="#">Sosialt</a></div>
        <div><a class="footerInnhold" href="#">Snapchat: @alvetoclothing</a></div>
        <div><a class="footerInnhold" href="#">Facebook: Alveto AS</a></div>
        <div><a class="footerInnhold" href="#">Nyhetsbrev</a></div>
        <div><a class="footerInnhold" href="#">Alveto's blogg</a></div>
      </section>
      <section>
        <div><a class="footerOverskrift" href="#">Informasjon</a></div>
        <div><a class="footerInnhold" href="#">Butikker</a></div>
        <div><a class="footerInnhold" href="#">Verdensbasis</a></div>
        <div><a class="footerInnhold" href="#">Utbredning</a></div>
        <div><a class="footerInnhold" href="#">Annet</a></div>
      </section>
      <section>
        <div><a class="footerOverskrift" href="#">Ressurser</a></div>
        <div><a class="footerInnhold" href="#">Nettside</a></div>
        <div><a class="footerInnhold" href="#">Oppsett</a></div>
        <div><a class="footerInnhold" href="#">Bilder</a></div>
        <div><a class="footerInnhold" href="#">Produkter</a></div>
      </section>
      <section>
        <div><a class="footerOverskrift" href="#">Invester</a></div>
        <div><a class="footerInnhold" href="#">Aksjer</a></div>
        <div><a class="footerInnhold" href="#">Eiere</a></div>
        <div><a class="footerInnhold" href="#">Investorer</a></div>
        <div><a class="footerInnhold" href="#">Annen info</a></div>
      </section>
      <section>
        <div><a class="footerOverskrift" href="#">Kontakt oss</a></div>
        <div><a class="footerInnhold" href="#">Returnere produkter</a></div>
        <div><a class="footerInnhold" href="#">Tilbud</a></div>
        <div><a class="footerInnhold" href="#">Frakt</a></div>
        <div><a class="footerInnhold" href="#">Annet</a></div>
      </section>
    </footer>
    <script type="text/javascript">
      const db = firebase.database();
      const klaer = db.ref("Klaer");
      const sko = db.ref("Klaer/Sko");
      const bukser = db.ref("Klaer/Bukser");
      const gensere = db.ref("Klaer/Gensere");
      const tskjorter = db.ref("Klaer/Tskjorter");
      const tilbehoer = db.ref("Klaer/Tilbehør");
      const skjorter = db.ref("Klaer/Skjorter");
      const jakker = db.ref("Klaer/Jakker");
      const undertoey = db.ref("Klaer/Undertøy");

      const secProduktinfo = document.querySelector(".secProduktinfo");
      const secProduktLignende = document.querySelector(".secProduktLignende");
      const titleProduktinformasjon = document.querySelector(".titleProduktinformasjon")

      let url_string = window.location.href;
      let url = new URL(url_string);
      let parentId = url.searchParams.get("parent");
      let id = url.searchParams.get("id");

      const valgtProdukt = db.ref("Klaer/"+ parentId + "/" + id );
      valgtProdukt.on("value",genererProduktinfo);

      function genererProduktinfo(snapshot){
        console.log(snapshot.val());
        let klesplagg = snapshot.val();
        let stoerrelser = ``;
        let farger = ``;
        for (let stoerrelse of klesplagg.stoerrelse) {
          stoerrelser += `<option value="${stoerrelse}">${stoerrelse}</option>`
        };
        for (let farge of klesplagg.farge) {
          farger += `<option value="${farge}">${farge}</option>`
        };
        if (klesplagg.omTilbud === true) {
          pris = klesplagg.pris*(1-klesplagg.tilbud);
          tilbud = `<div class="tilbudProduktinfo">${klesplagg.tilbud*100}%</div>`;
          tilbudPris = `<div class="tilbudsprisProduktinfo">${pris.toFixed(2)} kr</div>`;
          originalPris = `<div style="text-decoration:line-through" class="originalprisProduktinfo">${klesplagg.pris.toFixed(2)} kr</div>`;
        }
        else {
          pris = klesplagg.pris;
          tilbud = ``;
          tilbudPris = ``;
          originalPris = `<div class="originalprisProduktinfo">${klesplagg.pris.toFixed(2)} kr</div>`;
        };
        secProduktinfo.innerHTML += `
          <section class="stortBildeProduktinfo">
            <img src="Bilder/Bilder${parentId}/${klesplagg.bilde1}">
          </section>
          <section class="liteBildeProduktinfo">
            <img src="Bilder/Bilder${parentId}/${klesplagg.bilde2}">
          </section>
          <section class="infoProduktinfo">
            ${originalPris}
            ${tilbud}
            ${tilbudPris}
            <div class="produktnavnProduktinfo">${klesplagg.produktnavn}</div>
            <div class="merkenavnProduktinfo">${klesplagg.merkenavn}</div>
            <div class="skjema">
              <form>
                <p>Produktet er tilgjengelig i disse fargene:</p>
                <select name="farge" required>
                  <option value="">Farge</option>
                  ${farger}
                </select>
                <p>Produktet er tilgjengelig i disse størrelsene:</p>
                <select name="stoerrelse" required>
                  <option value="">Størrelse</option>
                  ${stoerrelser}
                </select>
                <p>Hvor mange ønsker du å kjøpe?</p>
                <input type="number" autocomplete="off" min="0" name="antall" required>
                <button type="reset" method="get">Legg til i handlekurv</button> <!-- Vanligvis hadde dette vært en "submit", men siden Alveto ikke har en handlekurv, står det "reset" inntil videre -->
              </form>
            </div>
            <div class="friFrakt">Dersom ordren din havner på over 1 700 kr, blir frakten din gratis.</div>
            <div class="sendetid">Vår sendetid er på 3-5 dager.</div>
          </section>
          <section class="liteBildeProduktinfo">
            <img src="Bilder/Bilder${parentId}/${klesplagg.bilde3}">
          </section>
        `;
      };

      function generer_LignendeProdukter(snapshot){
        console.log(snapshot.val());
        let klesplagg = snapshot.val();
        let key = snapshot.key;
        let parent = snapshot.ref.parent.key;
        if(klesplagg.omTilbud === true){
          pris = klesplagg.pris*(1-klesplagg.tilbud);
          tilbud = `<div class="tilbud">${klesplagg.tilbud*100}%</div>`;
          tilbudPris = `<div class="tilbudspris">${pris.toFixed(2)} kr</div>`;
          originalPris = `<div style="text-decoration:line-through" class="originalpris">${klesplagg.pris.toFixed(2)} kr</div>`;
        }
        else{
          pris = klesplagg.pris;
          tilbud = ``;
          tilbudPris = ``;
          originalPris = `<div class="originalpris">${klesplagg.pris.toFixed(2)} kr</div>`;
        };
        secProduktLignende.innerHTML += `
          <section class="secForsideElement">
            <a href="produktinformasjon.html?id=${key}&parent=${parent}" class="secKlaer">
              <div class="bilde"><img src="Bilder/Bilder${parent}/${klesplagg.bilde1}"></div>
              <div class="merkenavn">${klesplagg.merkenavn}</div>
              <div class="produktnavn">${klesplagg.produktnavn}</div>
              ${originalPris}
              ${tilbud}
              ${tilbudPris}
            </a>
          </section>
        `;
      };

      function genererTitleProduktinformasjon(snapshot) {
        console.log(snapshot.val());
        let klesplagg = snapshot.val();
        let key = snapshot.key;
        let parent = snapshot.ref.parent.key;
        titleProduktinformasjon.innerHTML += `
          <div>${klesplagg.produktnavn} - ${klesplagg.merkenavn} - ${parent} - Alveto</div>
        `;
      };

      function lignendeProdukter(){
        sko
          .orderByChild("pris")
          .limitToFirst(1)
          .on("child_added",generer_LignendeProdukter);
        gensere
          .orderByChild("pris")
          .limitToLast(1)
          .on("child_added",generer_LignendeProdukter);
        skjorter
          .orderByChild("pris")
          .limitToLast(1)
          .on("child_added",generer_LignendeProdukter);
        undertoey
          .orderByChild("pris")
          .limitToLast(1)
          .on("child_added",generer_LignendeProdukter);
        jakker
          .orderByChild("pris")
          .limitToLast(1)
          .on("child_added",generer_LignendeProdukter);
        tilbehoer
          .orderByChild("pris")
          .limitToLast(1)
          .on("child_added",generer_LignendeProdukter);
      };

      lignendeProdukter();
    </script>
  </body>
</html>
